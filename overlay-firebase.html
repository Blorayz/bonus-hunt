<!DOCTYPE html>
<html lang="pt" style="background: transparent;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Bonus Hunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: transparent !important;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: transparent !important;
            overflow: hidden;
            color: #fff;
        }

        .overlay-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            max-width: calc(100vw - 40px);
            background: linear-gradient(135deg, #1a1f35 0%, #0f1522 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(218, 165, 32, 0.4);
            display: flex;
            gap: 20px;
            overflow: hidden;
            opacity: 1;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translateY(0);
        }

        .overlay-container.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .overlay-container.showing {
            animation: fadeInUp 0.5s ease-in-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* LEFT PANEL - STATS */
        .left-panel {
            width: 200px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hunt-header {
            text-align: left;
        }

        .hunt-title {
            font-size: 13px;
            font-weight: bold;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .main-stats {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid rgba(218, 165, 32, 0.3);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            font-size: 11px;
            color: #daa520;
            text-transform: uppercase;
            font-weight: 600;
        }

        .stat-value {
            font-size: 13px;
            font-weight: bold;
            color: #fff;
        }

        .stat-value.positive {
            color: #4ade80;
        }

        .stat-value.negative {
            color: #f87171;
        }

        .progress-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid rgba(218, 165, 32, 0.3);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 11px;
            color: #daa520;
            text-transform: uppercase;
            font-weight: 600;
        }

        .progress-count {
            font-size: 13px;
            font-weight: bold;
            color: #fff;
        }

        .progress-count .opened {
            color: #4ade80;
        }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #daa520 0%, #daa520 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-percent {
            font-size: 10px;
            color: #daa520;
            text-align: right;
        }

        /* RIGHT PANEL - SLOTS */
        .slots-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 0;
            overflow: hidden;
        }

        .slots-header {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .header-badge {
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid rgba(218, 165, 32, 0.3);
            font-size: 11px;
            color: #daa520;
            text-transform: uppercase;
            font-weight: 600;
            white-space: nowrap;
        }

        .header-badge .value {
            color: #fff;
            font-weight: bold;
            margin-left: 5px;
        }

        .slots-container {
            display: flex;
            gap: 12px;
            overflow-x: scroll !important;
            overflow-y: hidden;
            padding: 5px 5px 15px 5px;
            flex: 1;
            min-width: 0;
            width: 100%;
        }

        /* Scrollbar FORÃ‡ADA */
        .slots-container::-webkit-scrollbar {
            height: 12px !important;
            display: block !important;
        }

        .slots-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5) !important;
            border-radius: 6px;
        }

        .slots-container::-webkit-scrollbar-thumb {
            background: #daa520 !important;
            border-radius: 6px;
            border: 2px solid rgba(0, 0, 0, 0.5);
        }

        .slots-container::-webkit-scrollbar-thumb:hover {
            background: #daa520 !important;
        }

        /* SLOT CARD */
        .slot-card {
            width: 130px;
            flex-shrink: 0;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(180deg, #1f1535 0%, #0f0820 100%);
            border: 2px solid rgba(218, 165, 32, 0.3);
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
        }

        .slot-card:hover {
            transform: translateY(-5px);
            border-color: rgba(218, 165, 32, 0.5);
            box-shadow: 0 8px 24px rgba(218, 165, 32, 0.35);
        }

        .slot-card.opened {
            border-color: #4ade80;
            background: linear-gradient(180deg, #1a3a2a 0%, #0f1f15 100%);
        }

        .slot-image-container {
            position: relative;
            width: 100%;
            height: 180px;
        }

        .slot-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slot-number-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.85);
            color: #daa520;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            border: 1px solid rgba(218, 165, 32, 0.4);
        }

        .slot-status-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(74, 222, 128, 0.95);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 8px rgba(74, 222, 128, 0.6);
        }

        .slot-name-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95), transparent);
            padding: 8px;
            padding-top: 20px;
        }

        .slot-provider {
            font-size: 9px;
            color: #daa520;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .slot-name {
            font-size: 10px;
            font-weight: bold;
            color: #fff;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .slot-footer {
            background: rgba(0, 0, 0, 0.4);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .slot-payout {
            font-size: 13px;
            font-weight: bold;
            color: #fff;
            text-align: center;
        }

        .slot-payout.opened {
            color: #4ade80;
            font-size: 14px;
        }

        .slot-multiplier {
            font-size: 11px;
            color: #daa520;
            text-align: center;
            font-weight: 600;
        }

        .empty-state {
            width: 100%;
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1em;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="overlay-container">
        <!-- LEFT PANEL - STATS -->
        <div class="left-panel">
            <div class="hunt-header">
                <div class="hunt-title">ðŸŽ° Bonus Hunt</div>
            </div>

            <div class="main-stats">
                <div class="stat-row">
                    <span class="stat-label">Target</span>
                    <span class="stat-value" id="targetValue">â‚¬0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Avg</span>
                    <span class="stat-value" id="avgValue">0.00x</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">B/E</span>
                    <span class="stat-value" id="beValue">0.00x</span>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-label">Progress</span>
                    <span class="progress-count">
                        <span class="opened" id="openedCount">0</span>/<span id="totalCount">0</span>
                    </span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-percent" id="progressPercent">0%</div>
            </div>

            <div class="main-stats">
                <div class="stat-row">
                    <span class="stat-label">Total</span>
                    <span class="stat-value" id="totalPayValue">â‚¬0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">P/L</span>
                    <span class="stat-value" id="profitLossValue">â‚¬0.00</span>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL - SLOTS -->
        <div class="slots-section">
            <div class="slots-header">
                <div class="header-badge">
                    <span>Bonus Slots</span>
                </div>
            </div>

            <div class="slots-container" id="slotsContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸŽ°</div>
                    <div class="empty-state-text">No bonus added</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // ===== CONFIGURAÃ‡ÃƒO FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyDMf-hKiBYiZKARLyP11Ocq2IOtZ9DF2AY",
            authDomain: "ruidex.firebaseapp.com",
            databaseURL: "https://ruidex-default-rtdb.firebaseio.com",
            projectId: "ruidex",
            storageBucket: "ruidex.firebasestorage.app",
            messagingSenderId: "163689134002",
            appId: "1:163689134002:web:ea5af18bc85b0b6ac596ab",
            measurementId: "G-RYR1BHTYCS"
        };

        // Inicializa Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('âœ… Firebase inicializado!');
        } catch (error) {
            console.error('âŒ Erro ao inicializar Firebase:', error);
        }

        // ===== DOM ELEMENTS =====
        const elements = {
            targetValue: document.getElementById('targetValue'),
            avgValue: document.getElementById('avgValue'),
            beValue: document.getElementById('beValue'),
            openedCount: document.getElementById('openedCount'),
            totalCount: document.getElementById('totalCount'),
            progressBar: document.getElementById('progressBar'),
            progressPercent: document.getElementById('progressPercent'),
            totalPayValue: document.getElementById('totalPayValue'),
            profitLossValue: document.getElementById('profitLossValue'),
            slotsContainer: document.getElementById('slotsContainer')
        };

        // ===== HELPERS =====
        function formatCurrency(value) {
            return `â‚¬${parseFloat(value || 0).toFixed(2)}`;
        }

        function formatMultiplier(value) {
            return `${parseFloat(value || 0).toFixed(2)}x`;
        }

        // ===== CALCULATE STATS =====
        function calculateStats(data) {
            const slots = data.slots || [];
            const totalSlots = slots.length;
            const openedSlots = slots.filter(s => s.opened).length;
            const progressPercent = totalSlots > 0 ? (openedSlots / totalSlots) * 100 : 0;

            const totalBet = slots.reduce((sum, s) => sum + (s.betAmount || 0), 0);
            const totalPay = slots.reduce((sum, s) => s.opened ? sum + (s.winAmount || 0) : sum, 0);
            const profitLoss = totalPay - (data.stats?.start || 0);

            const avgMultiplier = openedSlots > 0 
                ? slots.filter(s => s.opened).reduce((sum, s) => {
                    const bet = s.betAmount || 1;
                    return sum + ((s.winAmount || 0) / bet);
                }, 0) / openedSlots
                : 0;

            const beMultiplier = totalBet > 0 ? (data.stats?.start || 0) / totalBet : 0;

            return {
                huntNumber: data.stats?.huntNumber || 1,
                target: data.stats?.start || 0,
                avgMultiplier,
                beMultiplier,
                totalSlots,
                openedSlots,
                progressPercent,
                totalPay,
                profitLoss
            };
        }

        // ===== CREATE SLOT CARD =====
        function createSlotCard(slot, index) {
            const bet = slot.betAmount || 0;
            const payout = slot.winAmount || 0;
            const multiplier = bet > 0 ? payout / bet : 0;
            const isOpened = slot.opened || false;

            return `
                <div class="slot-card ${isOpened ? 'opened' : ''}">
                    <div class="slot-image-container">
                        <img src="${slot.imageUrl || ''}" 
                             alt="${slot.slotName || ''}"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'130\' height=\'180\'%3E%3Crect fill=\'%231f1535\' width=\'130\' height=\'180\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23a78bfa\' font-size=\'48\'%3EðŸŽ°%3C/text%3E%3C/svg%3E'">
                        <div class="slot-number-badge">#${index + 1}</div>
                        ${isOpened ? '<div class="slot-status-badge">âœ“</div>' : ''}
                        <div class="slot-name-overlay">
                            <div class="slot-provider">${slot.provider || ''}</div>
                            <div class="slot-name">${slot.slotName || 'Slot'}</div>
                        </div>
                    </div>
                    <div class="slot-footer">
                        <div class="slot-payout ${isOpened ? 'opened' : ''}">
                            ${isOpened ? formatCurrency(payout) : formatCurrency(bet)}
                        </div>
                        <div class="slot-multiplier">
                            ${isOpened ? formatMultiplier(multiplier) : 'BET'}
                        </div>
                    </div>
                </div>
            `;
        }

        // ===== UPDATE UI =====
        function updateUI(data) {
            const stats = calculateStats(data);
            const slots = data.slots || [];

            // Update stats
            elements.targetValue.textContent = formatCurrency(stats.target);
            elements.avgValue.textContent = formatMultiplier(stats.avgMultiplier);
            elements.beValue.textContent = formatMultiplier(stats.beMultiplier);
            
            // Update progress
            elements.openedCount.textContent = stats.openedSlots;
            elements.totalCount.textContent = stats.totalSlots;
            elements.progressBar.style.width = stats.progressPercent + '%';
            elements.progressPercent.textContent = stats.progressPercent.toFixed(0) + '%';

            // Update totals
            elements.totalPayValue.textContent = formatCurrency(stats.totalPay);
            elements.profitLossValue.textContent = formatCurrency(stats.profitLoss);
            
            // Color profit/loss
            if (stats.profitLoss > 0) {
                elements.profitLossValue.classList.add('positive');
                elements.profitLossValue.classList.remove('negative');
            } else if (stats.profitLoss < 0) {
                elements.profitLossValue.classList.add('negative');
                elements.profitLossValue.classList.remove('positive');
            } else {
                elements.profitLossValue.classList.remove('positive', 'negative');
            }

            // Update slots
            if (slots.length === 0) {
                elements.slotsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽ°</div>
                        <div class="empty-state-text">No bonus added</div>
                    </div>
                `;
            } else {
                elements.slotsContainer.innerHTML = slots.map((slot, index) => 
                    createSlotCard(slot, index)
                ).join('');
            }

            console.log('ðŸ“Š Stats atualizadas:', {
                slots: stats.totalSlots,
                opened: stats.openedSlots,
                avgMulti: stats.avgMultiplier.toFixed(2),
                totalPay: formatCurrency(stats.totalPay),
                profitLoss: formatCurrency(stats.profitLoss)
            });
        }

        // ===== LOAD DATA FROM FIREBASE =====
        function loadData() {
            if (!database) {
                console.error('âŒ Firebase nÃ£o inicializado');
                return;
            }

            database.ref('bonus-hunt').on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    updateUI(data);
                    console.log('âœ… Dados atualizados!');
                }
            }, (error) => {
                console.error('âŒ Erro ao carregar dados:', error);
            });
        }

        // ===== CONTROLAR VISIBILIDADE DA OVERLAY =====
        function setupOverlayVisibility() {
            if (!database) {
                console.error('âŒ Firebase nÃ£o inicializado');
                return;
            }

            const overlayContainer = document.querySelector('.overlay-container');

            database.ref('overlay-visible').on('value', (snapshot) => {
                const isVisible = snapshot.val() !== false; // default true
                
                if (isVisible) {
                    overlayContainer.classList.remove('hidden');
                    overlayContainer.classList.add('showing');
                    console.log('ðŸ‘ï¸ Overlay visÃ­vel');
                    
                    // Remove a classe showing apÃ³s a animaÃ§Ã£o
                    setTimeout(() => {
                        overlayContainer.classList.remove('showing');
                    }, 500);
                } else {
                    overlayContainer.classList.add('hidden');
                    overlayContainer.classList.remove('showing');
                    console.log('ðŸ™ˆ Overlay escondida');
                }
            });
        }

        // ===== AUTO-SCROLL SUAVE =====
        let scrollPosition = 0;
        const SCROLL_SPEED = 1;
        const SCROLL_INTERVAL = 30;
        let isResetting = false;
        let isPaused = false;
        const RESET_SPEED = 2; // Velocidade ao voltar
        const PAUSE_DURATION = 4000; // Pausa de 4 segundos no inÃ­cio

        setInterval(() => {
            const container = elements.slotsContainer;
            
            if (!container || !container.scrollWidth || isPaused) return;
            
            const maxScroll = container.scrollWidth - container.clientWidth;
            
            if (maxScroll <= 0) return;
            
            if (isResetting) {
                // Voltar gradualmente para o inÃ­cio
                scrollPosition -= RESET_SPEED;
                
                if (scrollPosition <= 0) {
                    scrollPosition = 0;
                    isResetting = false;
                    isPaused = true;
                    
                    // Pausa de 4 segundos antes de recomeÃ§ar
                    setTimeout(() => {
                        isPaused = false;
                    }, PAUSE_DURATION);
                }
                
                container.scrollLeft = scrollPosition;
            } else {
                // Scroll normal para a direita
                scrollPosition += SCROLL_SPEED;
                
                if (scrollPosition >= maxScroll) {
                    isResetting = true;
                } else {
                    container.scrollLeft = scrollPosition;
                }
            }
            
        }, SCROLL_INTERVAL);

        // ===== START =====
        console.log('ðŸŽ° Iniciando Overlay Bonus Hunt...');
        console.log('ðŸ”¥ Modo: Firebase Realtime Database');
        
        loadData();
        setupOverlayVisibility();

        console.log('âœ… Overlay Bonus Hunt carregada com sucesso!');
    </script>
</body>
</html>
